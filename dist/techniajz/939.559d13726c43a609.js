"use strict";(self.webpackChunkcion_angular_16=self.webpackChunkcion_angular_16||[]).push([[939,221,534],{2214:(Y,S,r)=>{r.d(S,{n:()=>ct});var u=r(177),I=r(7673),M=r(6536),T=r(4714),C=r(2221),v=r(5312),t=r(4438),a=r(6911),p=r(9417);function A(o,g){if(1&o&&(t.j41(0,"a",15),t.nrm(1,"i",16),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.FCK("href","http://maps.google.com/?q=",e.loc.coordinates[0],",",e.loc.coordinates[1],"",t.B4B)}}function j(o,g){if(1&o&&(t.j41(0,"a",17),t.nrm(1,"i",18),t.k0s()),2&o){const e=t.XpG(2).$implicit,i=t.XpG();t.Y8G("href",i.imageFullPath+e.punchInSelfi,t.B4B)}}function $(o,g){if(1&o&&(t.j41(0,"a",15),t.nrm(1,"i",16),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.FCK("href","http://maps.google.com/?q=",e.outLoc.coordinates[0],",",e.outLoc.coordinates[1],"",t.B4B)}}function O(o,g){if(1&o&&(t.j41(0,"a",17),t.nrm(1,"i",18),t.k0s()),2&o){const e=t.XpG(2).$implicit,i=t.XpG();t.Y8G("href",i.imageFullPath+e.punchOutSelfi,t.B4B)}}function R(o,g){if(1&o&&(t.j41(0,"tr")(1,"td"),t.nrm(2,"ngb-highlight",12),t.DNE(3,A,2,3,"a",13)(4,j,2,1,"a",14),t.k0s(),t.j41(5,"td"),t.nrm(6,"ngb-highlight",12),t.DNE(7,$,2,3,"a",13)(8,O,2,1,"a",14),t.k0s()()),2&o){const e=t.XpG().$implicit,i=t.XpG();t.R7$(2),t.Y8G("result",i.convertTimeFormat(e.punchInTime.toString()))("term",i.service.searchTerm),t.R7$(),t.Y8G("ngIf",i.isPermission),t.R7$(),t.Y8G("ngIf",i.isPermission&&(null==e?null:e.punchInSelfi)&&""!==e.punchInSelfi),t.R7$(2),t.Y8G("result",i.convertTimeFormat(e.punchOutTime.toString()))("term",i.service.searchTerm),t.R7$(),t.Y8G("ngIf",i.isPermission&&"0"!==e.punchOutTime&&e.outLoc.coordinates.length>0),t.R7$(),t.Y8G("ngIf",i.isPermission&&(null==e?null:e.punchOutSelfi)&&""!==e.punchOutSelfi)}}function E(o,g){1&o&&t.DNE(0,R,9,8,"tr",11),2&o&&t.Y8G("ngIf","0"!==g.$implicit.punchInTime)}function b(o,g){1&o&&(t.j41(0,"tr",10)(1,"td",19),t.EFF(2,"No records found"),t.k0s()())}let _=(()=>{class o{constructor(e){this.service=e,this.closeModal=new t.bkB,this.paginationDisabled=!1,this.pageIndex=v.k.page,this.pageSize=v.k.pageSize,this.imageFullPath=v.c.imageBaseUrl,this.isPermission=!1}ngOnInit(){this.checkPermission(),this.paymentTableData$=(0,I.of)(this.ProjectDetails.history),this.pageItemList=M.g1}convertTimeFormat(e){if("0"===e)return"";const i=e.padStart(6,"0"),n=parseInt(i.slice(0,2),10),d=i.slice(2,4),c=i.slice(4,6),D=n<12||n>23?"AM":"PM";return`${(n%12||12).toString().padStart(2,"0")}:${d}:${c} ${D}`}checkPermission(){const e=localStorage.getItem("role");e&&(this.isPermission="Admin"===e)}convertDateFormat(e){return`${e.slice(6,8)}/${e.slice(4,6)}/${e.slice(0,4)}`}closeModel(){this.closeModal.emit()}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(C.a))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-attendance-history"]],inputs:{ProjectDetails:"ProjectDetails"},outputs:{closeModal:"closeModal"},features:[t.Jv_([C.a,u.QX])],decls:23,vars:4,consts:[[1,"modal-content"],[1,"modal-toggle-wrapper","text-start","dark-sign-up"],[1,"row","align-items-center"],["type","button","aria-label","Close",1,"btn-close","position-absolute","top-0","end-0","m-2","close-btn",3,"click"],[1,"col-12"],[1,"modal-header","justify-content-center","border-0","pb-0","m-0"],[1,"modal-body"],[1,"row","d-flex"],[1,"table-responsive","theme-scroollbar"],[1,"table","table-responsive"],[1,"odd"],[4,"ngIf"],[3,"result","term"],["target","_blank",3,"href",4,"ngIf"],["ngbTooltip","Image","target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],[1,"icon-location-pin","ps-1"],["ngbTooltip","Image","target","_blank",3,"href"],[1,"fa","fa-file-image-o","px-1"],["colspan","10",1,"dataTables_empty",2,"text-align","center"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),t.bIt("click",function(){return n.closeModel()}),t.k0s(),t.j41(4,"div",4)(5,"h3",5),t.EFF(6),t.k0s()()(),t.nrm(7,"hr"),t.j41(8,"div",6)(9,"div",7)(10,"form",8)(11,"table",9)(12,"thead")(13,"tr")(14,"th"),t.EFF(15,"Punch-In Time"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Punch-Out Time"),t.k0s()()(),t.j41(18,"tbody"),t.Z7z(19,E,1,1,"tr",null,t.fX1,!1,b,3,0,"tr",10),t.nI1(22,"async"),t.k0s()()()()()()()),2&i&&(t.R7$(6),t.SpI("Attendance History of ",n.ProjectDetails.empId.name,""),t.R7$(13),t.Dyx(t.bMT(22,2,n.paymentTableData$)))},dependencies:[u.bT,a.md,a.Qr,p.qT,p.cb,p.cV,u.Jj],styles:[".cdk-overlay-container{position:fixed;z-index:1060!important}  .mat-datepicker-content .mat-calendar{background-color:#fff!important}  .mat-mdc-form-field-flex{background-color:#fff!important;height:39px!important}.input-width[_ngcontent-%COMP%]{width:100%!important}  .mat-from-field{height:64px!important}  .mat-mdc-form-field-infix{padding-top:5px!important}  .mat-mdc-text-field-wrapper.mdc-text-field{border-radius:var(--bs-border-radius)!important;border:var(--bs-border-width) solid var(--bs-border-color)!important;background-color:#fff!important}  .mdc-line-ripple{display:none}  .mdc-text-field--focused{border:none;box-shadow:0 0 0 .25rem #0d6efd40!important;border-radius:var(--bs-border-radius)!important;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out!important;background-color:transparent!important}  .mat-calendar-controls button,   mat-datepicker-toggle{color:var(--theme-default)!important}  .success-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-danger-rgb),.25)!important}  .success-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-success-rgb),.25)!important}  .custom-select .ng-select-container,   input .list-input,   .list-input{border:solid 1px #33bfbf!important;border-color:#33bfbf!important}.error-msg[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#f1523d!important}.mt-custom[_ngcontent-%COMP%]{margin-top:-16px!important}[_nghost-%COMP%]     select.form-select:focus{border-color:#33bfbf;box-shadow:0 0 0 .25rem #33bfbf80}.active-sort[_ngcontent-%COMP%]{color:#fffc!important}  .ng-select-container{max-height:40px!important;overflow-y:auto!important}  .ng-dropdown-panel{max-height:auto!important}table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{color:inherit!important}.w-40[_ngcontent-%COMP%]{width:40%!important}.bold[_ngcontent-%COMP%]{font-weight:700}tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:nth-of-type(odd)   td[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:nth-of-type(odd)   th[_ngcontent-%COMP%]{background-color:#33bfbf1a!important;--bs-table-accent-bg: unset !important}.close-btn[_ngcontent-%COMP%]{z-index:3}"]})}return o})();var f=r(2616),k=r(4460),x=r(1626),F=r(9818);function G(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",20),t.EFF(1),t.j41(2,"button",21),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.close())}),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(),t.SpI(" ",e.errorMessage," ")}}function w(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",14)(1,"button",15),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.updateAttendance())}),t.EFF(2,"Update Attendance "),t.nrm(3,"i",16),t.k0s()()}}let m=(()=>{class o{constructor(e,i,n){this.sharedService=e,this.attendanceService=i,this.http=n,this.closeModal=new t.bkB,this.employeeList=[],this.date=new Date,this.showSubmit=!1}ngOnInit(){this.date.setDate(this.date.getDate()-1),this.maxDate=`${this.date.getFullYear()}-${this.date.getMonth()+1<=9?"0"+(this.date.getMonth()+1):this.date.getMonth()+1}-${this.date.getDate()<=9?"0"+this.date.getDate():this.date.getDate()}`,this.getEmployeeList()}getEmployeeList(){this.attendanceService.getEmpoyeeList().subscribe(e=>{let i=[];for(let n of e.data.employee)i.push({_id:n._id,name:n.name+" ( Emp Id : "+n.id+")"});this.employeeList=i})}closeModel(){this.closeModal.emit()}close(){this.errorMessage=null}downloadFile(e){this.http.get(`assets/images/${e}`,{responseType:"blob"}).subscribe(n=>{const d=window.URL.createObjectURL(n),c=document.createElement("a");c.href=d,c.download=e,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(d)},n=>{console.error("Download error:",n)})}getEmployeAtt(){this.showSubmit=!0,this.attendanceService.checkEmployeeAttendanceStatus({empId:this.empId,attDate:this.Date}).subscribe(i=>{i.success&&(this.inTime=this.convertTimeFormat(i.data.checkEmployeeAtt.punchInTime),this.outTime=this.convertTimeFormat(i.data.checkEmployeeAtt.punchOutTime),this.attId=i.data.checkEmployeeAtt._id,"0"===i.data.checkEmployeeAtt.punchInTime&&(this.errorMessage="Employee didn't marked Attendance"))},i=>{"Unauthorized access."===i.error.message?this.sharedService.logOut():this.errorMessage=i?.error?.message})}updateAttendance(){if(this.inTime&&this.outTime&&this.empId){const e=new FormData;let i=this.convertTime(this.inTime),n=this.convertTime(this.outTime);e.append("attId",this.attId),e.append("date",this.Date),e.append("empId",this.empId),e.append("lat","26.8717246"),e.append("long","75.7756239"),e.append("punchInTime",i),e.append("punchOutTime",n),this.attendanceService.markEmployeeAttendance(e).subscribe(d=>{d.success&&this.closeModel()})}}convertTime(e){return e.replace(":","")+"00"}convertTimeFormat(e){if("0"===e)return"00:00";const i=e.padStart(6,"0"),n=i.slice(0,2),d=i.slice(2,4);return i.slice(4,6),parseInt(n,10),`${n.padStart(2,"0")}:${d}`}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(f.d),t.rXU(k.$),t.rXU(x.Qq))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-add-employee-attendance"]],inputs:{ProjectDetails:"ProjectDetails"},outputs:{closeModal:"closeModal"},features:[t.Jv_([u.vh])],decls:32,vars:9,consts:[[1,"modal-content"],[1,"modal-toggle-wrapper","text-start","dark-sign-up"],[1,"row","align-items-center"],["type","button","aria-label","Close",1,"btn-close","position-absolute","top-0","end-0","m-2","close-btn",3,"click"],[1,"col-12"],[1,"modal-header","justify-content-center","border-0","pb-0","m-0"],[1,"modal-body"],["class","alert alert-danger d-flex justify-content-between align-items-center",4,"ngIf"],[1,"mb-2"],[1,"form-group","mb-3"],["for","imageFile",1,"form-label"],["id","Title","bindLabel","name","bindValue","_id","placeholder","Select Employee",1,"custom-select",3,"ngModelChange","items","clearable","ngModel"],["for","Date",1,"form-label"],["type","date","name","Date","id","Date",1,"form-control",3,"ngModelChange","max","ngModel"],[1,"d-flex","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary","btn-block",3,"click"],[1,"fa","fa-file-excel-o"],["for","inTime",1,"form-label"],["type","time","name","inTime","id","inTime",1,"form-control",3,"ngModelChange","ngModel"],["class","d-flex justify-content-center mt-2",4,"ngIf"],[1,"alert","alert-danger","d-flex","justify-content-between","align-items-center"],["type","button","aria-label","Close",1,"btn-close",3,"click"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),t.bIt("click",function(){return n.closeModel()}),t.k0s(),t.j41(4,"div",4)(5,"h3",5),t.EFF(6,"Edit Attendance"),t.k0s()()(),t.nrm(7,"hr"),t.j41(8,"div",6),t.DNE(9,G,3,1,"div",7),t.j41(10,"div",8)(11,"div",9)(12,"label",10),t.EFF(13,"Select Employee"),t.k0s(),t.j41(14,"ng-select",11),t.mxI("ngModelChange",function(c){return t.DH7(n.empId,c)||(n.empId=c),c}),t.k0s()(),t.j41(15,"div",9)(16,"label",12),t.EFF(17,"Select Date"),t.k0s(),t.j41(18,"input",13),t.mxI("ngModelChange",function(c){return t.DH7(n.Date,c)||(n.Date=c),c}),t.k0s()(),t.j41(19,"div",14)(20,"button",15),t.bIt("click",function(){return n.getEmployeAtt()}),t.EFF(21,"Get Attendance "),t.nrm(22,"i",16),t.k0s()(),t.j41(23,"div",9)(24,"label",17),t.EFF(25,"Select Intime"),t.k0s(),t.j41(26,"input",18),t.mxI("ngModelChange",function(c){return t.DH7(n.inTime,c)||(n.inTime=c),c}),t.k0s()(),t.j41(27,"div",9)(28,"label",17),t.EFF(29,"Select Outtime"),t.k0s(),t.j41(30,"input",18),t.mxI("ngModelChange",function(c){return t.DH7(n.outTime,c)||(n.outTime=c),c}),t.k0s()(),t.DNE(31,w,4,0,"div",19),t.k0s()()()()),2&i&&(t.R7$(9),t.Y8G("ngIf",n.errorMessage),t.R7$(5),t.Y8G("items",n.employeeList)("clearable",!1),t.R50("ngModel",n.empId),t.R7$(4),t.Y8G("max",n.maxDate),t.R50("ngModel",n.Date),t.R7$(8),t.R50("ngModel",n.inTime),t.R7$(4),t.R50("ngModel",n.outTime),t.R7$(),t.Y8G("ngIf",n.showSubmit&&n.inTime&&n.outTime))},dependencies:[u.bT,p.me,p.BC,p.vS,F.vr],styles:[".cdk-overlay-container{position:fixed;z-index:1060!important}  .mat-datepicker-content .mat-calendar{background-color:#fff!important}  .mat-mdc-form-field-flex{background-color:#fff!important;height:39px!important}.input-width[_ngcontent-%COMP%]{width:100%!important}  .mat-from-field{height:64px!important}  .mat-mdc-form-field-infix{padding-top:5px!important}  .mat-mdc-text-field-wrapper.mdc-text-field{border-radius:var(--bs-border-radius)!important;border:var(--bs-border-width) solid var(--bs-border-color)!important;background-color:#fff!important}  .mdc-line-ripple{display:none}  .mdc-text-field--focused{border:none;box-shadow:0 0 0 .25rem #0d6efd40!important;border-radius:var(--bs-border-radius)!important;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out!important;background-color:transparent!important}  .mat-calendar-controls button,   mat-datepicker-toggle{color:var(--theme-default)!important}  .success-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-danger-rgb),.25)!important}  .success-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-success-rgb),.25)!important}  .custom-select .ng-select-container,   input .list-input,   .list-input{border:solid 1px #33bfbf!important;border-color:#33bfbf!important}.error-msg[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#f1523d!important}.mt-custom[_ngcontent-%COMP%]{margin-top:-16px!important}[_nghost-%COMP%]     select.form-select:focus{border-color:#33bfbf;box-shadow:0 0 0 .25rem #33bfbf80}.active-sort[_ngcontent-%COMP%]{color:#fffc!important}  .ng-select-container{max-height:40px!important;overflow-y:auto!important}  .ng-dropdown-panel{max-height:auto!important}.close-btn[_ngcontent-%COMP%]{z-index:3}.alert[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]})}return o})();var X=r(7062),l=r(9652);const s=["openmodal"],h=o=>({lateEntry:o});function y(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",21)(1,"div",22),t.nrm(2,"div",23),t.k0s(),t.j41(3,"div",24)(4,"div",25)(5,"button",26),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onRefreshData())}),t.EFF(6,"Refresh "),t.nrm(7,"i",27),t.k0s()()()()}}function B(o,g){1&o&&t.nrm(0,"hr")}function P(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",5)(1,"label"),t.EFF(2,"Select Employee"),t.k0s(),t.j41(3,"ng-select",29),t.mxI("ngModelChange",function(n){t.eBV(e);const d=t.XpG(2);return t.DH7(d.employeeId,n)||(d.employeeId=n),t.Njj(n)}),t.bIt("clear",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.onClearType())}),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("items",e.employeeList),t.R50("ngModel",e.employeeId)}}function U(o,g){if(1&o&&t.DNE(0,P,4,2,"div",28),2&o){const e=t.XpG();t.Y8G("ngIf",!e.isDetailPage)}}function H(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",30)(1,"label",31),t.EFF(2,"Download"),t.k0s(),t.j41(3,"button",32),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.getDownloadData())}),t.nrm(4,"i",33),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(3),t.Y8G("disabled",!e.tableData$)}}function Q(o,g){if(1&o){const e=t.RV6();t.j41(0,"div",9)(1,"label",31),t.EFF(2,"Add Employee Attendance"),t.k0s(),t.j41(3,"button",32),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.openEmployeeModal())}),t.nrm(4,"app-feathericon",34),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(3),t.Y8G("disabled",!e.tableData$),t.R7$(),t.Y8G("icon","edit")}}function J(o,g){1&o&&(t.j41(0,"th"),t.EFF(1,"Total Time"),t.k0s())}function W(o,g){if(1&o&&(t.j41(0,"td",39),t.nrm(1,"ngb-highlight",36),t.k0s()),2&o){const e=t.XpG(2);t.R7$(),t.Y8G("result","On Leave")("term",e.service.searchTerm)}}function Z(o,g){if(1&o&&(t.j41(0,"a",41),t.nrm(1,"i",42),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.FCK("href","http://maps.google.com/?q=",e.loc.coordinates[0],",",e.loc.coordinates[1],"",t.B4B)}}function q(o,g){if(1&o&&(t.j41(0,"td",35),t.nrm(1,"ngb-highlight",36),t.DNE(2,Z,2,3,"a",40),t.k0s()),2&o){const e=t.XpG().$implicit,i=t.XpG();t.Y8G("ngClass",t.eq3(4,h,e.punchInTime&&e.punchOutTime&&i.changeBackgroundColor(e.punchInTime.toString(),e.punchOutTime.toString(),e.attDate.toString()))),t.R7$(),t.Y8G("result",i.convertTimeFormat(e.punchInTime.toString()))("term",i.service.searchTerm),t.R7$(),t.Y8G("ngIf",i.isPermission&&"0"!==e.punchInTime&&e.loc.coordinates.length>0)}}function tt(o,g){if(1&o&&(t.j41(0,"a",41),t.nrm(1,"i",42),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.FCK("href","http://maps.google.com/?q=",e.outLoc.coordinates[0],",",e.outLoc.coordinates[1],"",t.B4B)}}function et(o,g){if(1&o&&(t.j41(0,"td",35),t.nrm(1,"ngb-highlight",36),t.DNE(2,tt,2,3,"a",40),t.k0s()),2&o){const e=t.XpG().$implicit,i=t.XpG();t.Y8G("ngClass",t.eq3(4,h,e.punchInTime&&e.punchOutTime&&i.changeBackgroundColor(e.punchInTime.toString(),e.punchOutTime.toString(),e.attDate.toString()))),t.R7$(),t.Y8G("result",i.convertTimeFormat(e.punchOutTime.toString()))("term",i.service.searchTerm),t.R7$(),t.Y8G("ngIf",i.isPermission&&"0"!==e.punchOutTime&&e.outLoc.coordinates.length>0)}}function nt(o,g){if(1&o&&(t.j41(0,"td",35),t.nrm(1,"ngb-highlight",36),t.k0s()),2&o){const e=t.XpG().$implicit,i=t.XpG();t.Y8G("ngClass",t.eq3(3,h,e.punchInTime&&e.punchOutTime&&i.changeBackgroundColor(e.punchInTime.toString(),e.punchOutTime.toString(),e.attDate.toString()))),t.R7$(),t.Y8G("result","0"===e.totalHours?"0 h":e.totalHours)("term",i.service.searchTerm)}}function it(o,g){if(1&o){const e=t.RV6();t.j41(0,"button",45),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2).$implicit,d=t.XpG();return t.Njj(d.openModal(n))}),t.nrm(1,"i",46),t.k0s()}}function ot(o,g){if(1&o&&(t.j41(0,"td")(1,"ul",43),t.DNE(2,it,2,0,"button",44),t.k0s()()),2&o){const e=t.XpG().$implicit;t.R7$(2),t.Y8G("ngIf","0"!==e.punchInTime)}}function at(o,g){if(1&o&&(t.j41(0,"tr")(1,"td",35),t.nrm(2,"ngb-highlight",36),t.k0s(),t.j41(3,"td",35),t.nrm(4,"ngb-highlight",36),t.k0s(),t.DNE(5,W,2,2,"td",37)(6,q,3,6,"td",38)(7,et,3,6,"td",38)(8,nt,2,5,"td",38)(9,ot,3,1,"td",3),t.k0s()),2&o){const e=g.$implicit,i=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(11,h,e.punchInTime&&e.punchOutTime&&i.changeBackgroundColor(e.punchInTime.toString(),e.punchOutTime.toString(),e.attDate.toString())&&!e.isLeave)),t.R7$(),t.Y8G("result",e.empId.name)("term",i.service.searchTerm),t.R7$(),t.Y8G("ngClass",t.eq3(13,h,e.punchInTime&&e.punchOutTime&&i.changeBackgroundColor(e.punchInTime.toString(),e.punchOutTime.toString(),e.attDate.toString())&&!e.isLeave)),t.R7$(),t.Y8G("result",i.convertDateFormat(e.attDate.toString()))("term",i.service.searchTerm),t.R7$(),t.Y8G("ngIf",e.isLeave),t.R7$(),t.Y8G("ngIf",!e.isLeave),t.R7$(),t.Y8G("ngIf",!e.isLeave),t.R7$(),t.Y8G("ngIf",i.isPermission&&!e.isLeave),t.R7$(),t.Y8G("ngIf",!e.isLeave)}}function st(o,g){1&o&&(t.j41(0,"tr",16)(1,"td",47),t.EFF(2,"No records found"),t.k0s()())}function rt(o,g){if(1&o&&(t.j41(0,"option",48),t.EFF(1),t.k0s()),2&o){const e=g.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.description+" Items per page")}}let ct=(()=>{class o{constructor(e,i,n,d,c,D){this.service=e,this.sharedService=i,this.attendanceService=n,this.route=d,this.modalService=c,this.datePipe=D,this.pageIndex=v.k.page,this.pageSize=v.k.pageSize,this.title="",this.paginationDisabled=!1,this.date=new Date,this.startDate=new Date,this.endDate=new Date,this.maxDate=new Date,this.isPermission=!1,this.isDetailPage=!1}ngOnInit(){this.pageItemList=M.g1,this.startDate=`${this.date.getFullYear()}-${this.date.getMonth()+1<=9?"0"+(this.date.getMonth()+1):this.date.getMonth()+1}-01`,this.endDate=`${this.date.getFullYear()}-${this.date.getMonth()+1<=9?"0"+(this.date.getMonth()+1):this.date.getMonth()+1}-${this.date.getDate()<=9?"0"+this.date.getDate():this.date.getDate()}`,this.maxDate=this.sharedService.maxDate,this.route.params.subscribe(e=>{e.id?(this.isDetailPage=!0,this.employeeId=e.id):this.sharedService.changeTitle("Attendance Record")}),this.checkPermission(),this.getEmployeeList()}loadPage(e,i){this.pageSize=i,this.pageIndex=e,this.getAttendenceList()}onRefreshData(){this.service.page=v.k.page,this.service.pageSize=v.k.pageSize,this.pageIndex=v.k.page,this.pageSize=v.k.pageSize,this.isPermission&&(this.employeeId=null),this.startDate=`${this.date.getFullYear()}-${this.date.getMonth()+1<=9?"0"+(this.date.getMonth()+1):this.date.getMonth()+1}-01`,this.endDate=`${this.date.getFullYear()}-${this.date.getMonth()+1<=9?"0"+(this.date.getMonth()+1):this.date.getMonth()+1}-${this.date.getDate()<=9?"0"+this.date.getDate():this.date.getDate()}`,this.getAttendenceList()}onClearType(){this.employeeId=null}onTypeFilter(e){this.employeeId=e?._id,this.employeeId&&this.getAttendenceList()}getAttendenceList(){this.sharedService.isLoading=!0,this.paginationDisabled=!1,this.attendanceService.getAttendance({page:this.pageIndex,limit:this.pageSize,startDate:this.startDate,endDate:this.endDate},this.employeeId?`/${this.employeeId}`:"").subscribe(n=>{n.data&&n.data.attList?(this.tableData$=(0,I.of)(n.data.attList??[]),this.total$=(0,I.of)(n.data.total??0)):this.sharedService.displayServerMessage("Technical Error Occurred.","error")},n=>{"Unauthorized access."===n.error.message?this.sharedService.logOut():400!==n?.status&&this.sharedService.displayServerMessage(n?.error?.message??"An error occurred","error"),this.sharedService.isLoading=!1,this.paginationDisabled=!1},()=>{this.sharedService.isLoading=!1,this.paginationDisabled=!0})}getEmployeeList(){this.attendanceService.getEmpoyeeList().subscribe(e=>{let i=[];for(let n of e.data.employee)i.push({_id:n._id,name:n.name+" ( Emp Id : "+n.id+")"});this.employeeList=i})}convertDateFormat(e){return`${e.slice(6,8)}/${e.slice(4,6)}/${e.slice(0,4)}`}transformDate(e){return"1970-01-01T00:00:00.000Z"===e?"00:00":this.datePipe.transform(e,"hh : mm a")||""}maintainDateRange(){this.endDate<this.startDate&&(this.endDate=null)}convertTimeFormat(e){if("0"===e)return"";const i=e.padStart(6,"0"),n=i.slice(0,2),d=i.slice(2,4),c=i.slice(4,6),D=parseInt(n,10),z=D<12||D>23?"AM":"PM";return`${(D%12||12).toString().padStart(2,"0")}:${d}:${c} ${z}`}changeBackgroundColor(e,i,n){if(!this.isPermission)return!1;const c=L=>new Date(0,0,0,parseInt(L.slice(0,2),10),parseInt(L.slice(2,4),10),parseInt(L.slice(4,6),10)),D=L=>L.padStart(6,"0"),z=new Date,N=(L=>{const pt=parseInt(L.slice(0,4),10),ht=parseInt(L.slice(4,6),10)-1,gt=parseInt(L.slice(6,8),10);return new Date(pt,ht,gt)})(n),dt=z.toDateString()===N.toDateString();e=D(e),i=D(i);const V=c(e),lt=c(i),K=new Date(0,0,0,10,15),mt=new Date(0,0,0,18,30);return!(dt&&V<K&&"000000"===i)&&(V>K||lt<mt)}getDownloadData(){this.sharedService.isLoading=!0,this.paginationDisabled=!1,this.attendanceService.getDownloadData({startDate:this.startDate,endDate:this.endDate,isExport:!0},this.employeeId?`/${this.employeeId}`:"").subscribe(n=>this.downloadFile(n,"attendance.csv"),n=>this.handleFileError(n),()=>{this.sharedService.isLoading=!1,this.paginationDisabled=!0})}downloadFile(e,i){const n=new Blob([e],{type:"text/csv"}),d=window.URL.createObjectURL(n),c=document.createElement("a");c.href=d,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(d)}onAttendaceHistoryModal(e){const i=this.modalService.open(_,{size:"lg"});i.componentInstance.ProjectDetails=e,i.componentInstance.closeModal.subscribe(()=>{this.getAttendenceList(),i.close()})}onEmployeeAttendaceModal(){const e=this.modalService.open(m,{size:"lg"});e.componentInstance.closeModal.subscribe(()=>{this.getAttendenceList(),e.close()})}handleFileError(e){if(e.error instanceof Blob&&"application/json"===e.error.type){const i=new FileReader;i.onload=n=>{const d=JSON.parse(n.target.result);this.sharedService.displayServerMessage(d.message,"error")},i.readAsText(e.error)}else e.error&&this.sharedService.displayServerMessage(e.message,"error");this.sharedService.isLoading=!1}openEmployeeModal(){this.onEmployeeAttendaceModal()}openModal(e){const i={...e};this.onAttendaceHistoryModal(i)}handleError(e){e&&e.error&&this.sharedService.displayServerMessage(e.error,"error"),this.sharedService.isLoading=!1,this.paginationDisabled=!1}checkPermission(){const e=localStorage.getItem("role");null!==e&&(this.isPermission="Admin"===e),this.isPermission||(this.employeeId=localStorage.getItem("userId")),this.getAttendenceList()}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(C.a),t.rXU(f.d),t.rXU(k.$),t.rXU(X.nX),t.rXU(a.Bq),t.rXU(u.vh))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-attendance-list"]],viewQuery:function(i,n){if(1&i&&(t.GBs(s,5),t.GBs(T.f,5)),2&i){let d;t.mGM(d=t.lsd())&&(n.openModalTemplateRef=d.first),t.mGM(d=t.lsd())&&(n.headers=d)}},features:[t.Jv_([C.a,u.QX,u.vh])],decls:50,vars:28,consts:[[1,"card"],[1,"card-body"],["class","row justify-content-between mb-2",4,"ngIf"],[4,"ngIf"],[1,"row","mb-3","mt-2"],[1,"col-md-3","col-12"],["id","startDate","placeholder","","type","date",1,"form-control","digits","list-input",3,"ngModelChange","change","value","max","ngModel"],["id","endDate","placeholder","","type","date",1,"form-control","digits","list-input",3,"ngModelChange","change","value","min","ngModel"],[1,"col-md-3","d-flex","col-12"],[1,"mx-2"],["ngbTooltip","Search",1,"btn","btn-outline-primary","mt-2",3,"click"],[1,"icofont","icofont-search"],["class","ms-2","style","width: min-content",4,"ngIf"],["class","mx-2",4,"ngIf"],[1,"table-responsive","theme-scroollbar"],[1,"table","table-responsive","table-striped"],[1,"odd"],[1,"d-flex","justify-content-between","p-2","mb-5"],["name","pageSize",1,"form-select",2,"width","auto","cursor","pointer",3,"change","ngModelChange","disabled","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"ms-3",3,"pageChange","collectionSize","page","pageSize","disabled","maxSize"],[1,"row","justify-content-between","mb-2"],[1,"mx-0","row","col-md-7","col-12"],[1,"col-md-3","mx-1"],[1,"col-md-5","col-12","text-end"],[1,"btn-group","text-start","mb-2","mx-1","col-md-4","col-12"],[1,"btn","btn-outline-primary",3,"click"],[1,"icon-reload"],["class","col-md-3 col-12",4,"ngIf"],["id","type","bindLabel","name","bindValue","_id","placeholder","Select Employee",1,"custom-select",3,"ngModelChange","clear","items","ngModel"],[1,"ms-2",2,"width","min-content"],[1,"w-100"],[1,"btn","btn-outline-primary",3,"click","disabled"],[1,"icofont","icofont-download-alt"],[3,"icon"],[3,"ngClass"],[3,"result","term"],["colspan","10",4,"ngIf"],[3,"ngClass",4,"ngIf"],["colspan","10"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],[1,"icon-location-pin","px-1"],[1,"action"],["class","btn btn-outline-primary","ngbTooltip","History",3,"click",4,"ngIf"],["ngbTooltip","History",1,"btn","btn-outline-primary",3,"click"],["ps-2","","sweet-5","",1,"icofont","icofont-eye-alt"],["colspan","10",1,"dataTables_empty",2,"text-align","center"],[3,"value"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,y,8,0,"div",2)(3,B,1,0,"hr",3),t.j41(4,"div",4)(5,"div",5)(6,"label"),t.EFF(7,"Start Date"),t.k0s(),t.j41(8,"input",6),t.mxI("ngModelChange",function(c){return t.DH7(n.startDate,c)||(n.startDate=c),c}),t.bIt("change",function(){return n.maintainDateRange()}),t.k0s()(),t.j41(9,"div",5)(10,"label"),t.EFF(11,"End Date"),t.k0s(),t.j41(12,"input",7),t.mxI("ngModelChange",function(c){return t.DH7(n.endDate,c)||(n.endDate=c),c}),t.bIt("change",function(){return n.maintainDateRange()}),t.k0s()(),t.DNE(13,U,1,1,"div",5),t.j41(14,"div",8)(15,"div",9),t.nrm(16,"br"),t.j41(17,"button",10),t.bIt("click",function(){return n.getAttendenceList()}),t.nrm(18,"i",11),t.k0s()(),t.DNE(19,H,5,1,"div",12)(20,Q,5,2,"div",13),t.k0s()(),t.nrm(21,"hr"),t.j41(22,"form",14)(23,"table",15)(24,"thead")(25,"tr")(26,"th"),t.EFF(27,"Name"),t.k0s(),t.j41(28,"th"),t.EFF(29,"Date"),t.k0s(),t.j41(30,"th"),t.EFF(31,"Punch-In Time"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Punch-Out Time"),t.k0s(),t.DNE(34,J,2,0,"th",3),t.j41(35,"th"),t.EFF(36,"Action"),t.k0s()()(),t.j41(37,"tbody"),t.Z7z(38,at,10,15,"tr",null,t.fX1,!1,st,3,0,"tr",16),t.nI1(41,"async"),t.k0s()(),t.j41(42,"div",17)(43,"select",18),t.bIt("change",function(){return n.loadPage(n.service.page,n.service.pageSize)}),t.mxI("ngModelChange",function(c){return t.DH7(n.service.pageSize,c)||(n.service.pageSize=c),c}),t.DNE(44,rt,2,2,"option",19),t.k0s(),t.j41(45,"span"),t.EFF(46),t.nI1(47,"async"),t.k0s(),t.j41(48,"ngb-pagination",20),t.nI1(49,"async"),t.mxI("pageChange",function(c){return t.DH7(n.service.page,c)||(n.service.page=c),c}),t.bIt("pageChange",function(){return n.loadPage(n.service.page,n.service.pageSize)}),t.k0s()()()()()),2&i&&(t.R7$(2),t.Y8G("ngIf",!n.isDetailPage),t.R7$(),t.Y8G("ngIf",!n.isDetailPage),t.R7$(5),t.Y8G("value",n.startDate)("max",n.maxDate),t.R50("ngModel",n.startDate),t.R7$(4),t.Y8G("value",n.endDate)("min",n.startDate),t.R50("ngModel",n.endDate),t.R7$(),t.vxM(13,n.isPermission?13:-1),t.R7$(6),t.Y8G("ngIf",n.isPermission),t.R7$(),t.Y8G("ngIf",n.isPermission),t.R7$(14),t.Y8G("ngIf",n.isPermission),t.R7$(4),t.Dyx(t.bMT(41,22,n.tableData$)),t.R7$(5),t.Y8G("disabled",!n.paginationDisabled),t.R50("ngModel",n.service.pageSize),t.R7$(),t.Y8G("ngForOf",n.pageItemList),t.R7$(2),t.SpI("Total: ",t.bMT(47,24,n.total$),""),t.R7$(2),t.Y8G("collectionSize",t.bMT(49,26,n.total$)),t.R50("page",n.service.page),t.Y8G("pageSize",n.service.pageSize)("disabled",!n.paginationDisabled)("maxSize",6))},dependencies:[u.YU,u.Sq,u.bT,l.K,a.s5,a.md,a.Qr,p.qT,p.xH,p.y7,p.me,p.wz,p.BC,p.cb,p.vS,p.cV,F.vr,u.Jj],styles:[".cdk-overlay-container{position:fixed;z-index:1060!important}  .mat-datepicker-content .mat-calendar{background-color:#fff!important}  .mat-mdc-form-field-flex{background-color:#fff!important;height:39px!important}.input-width[_ngcontent-%COMP%]{width:100%!important}  .mat-from-field{height:64px!important}  .mat-mdc-form-field-infix{padding-top:5px!important}  .mat-mdc-text-field-wrapper.mdc-text-field{border-radius:var(--bs-border-radius)!important;border:var(--bs-border-width) solid var(--bs-border-color)!important;background-color:#fff!important}  .mdc-line-ripple{display:none}  .mdc-text-field--focused{border:none;box-shadow:0 0 0 .25rem #0d6efd40!important;border-radius:var(--bs-border-radius)!important;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out!important;background-color:transparent!important}  .mat-calendar-controls button,   mat-datepicker-toggle{color:var(--theme-default)!important}  .success-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-icon .ng-select-container{padding-right:calc(1.5em + .75rem)!important;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e\")!important;background-repeat:no-repeat!important;background-position:right calc(.375em + .1875rem) center!important;background-size:calc(.75em + .375rem) calc(.75em + .375rem)!important}  .error-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-danger-rgb),.25)!important}  .success-shadow .ng-select-container{box-shadow:0 0 0 .25rem rgba(var(--bs-success-rgb),.25)!important}  .custom-select .ng-select-container,   input .list-input,   .list-input{border:solid 1px #33bfbf!important;border-color:#33bfbf!important}.error-msg[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#f1523d!important}.mt-custom[_ngcontent-%COMP%]{margin-top:-16px!important}[_nghost-%COMP%]     select.form-select:focus{border-color:#33bfbf;box-shadow:0 0 0 .25rem #33bfbf80}.active-sort[_ngcontent-%COMP%]{color:#fffc!important}  .ng-select-container{max-height:40px!important;overflow-y:auto!important}  .ng-dropdown-panel{max-height:auto!important}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{background:transparent;color:transparent;cursor:pointer;height:auto;inset:0;position:absolute;width:auto}.lateEntry[_ngcontent-%COMP%]{color:#e23131!important}"]})}return o})()},9939:(Y,S,r)=>{r.r(S),r.d(S,{AttendanceModule:()=>w});var u=r(177),I=r(9417),M=r(9631),T=r(6911),C=r(9818),v=r(7960),t=r(7062),a=r(4438),p=r(2616),A=r(7575);function j(m,X){1&m&&a.nrm(0,"mat-progress-bar",1)}let $=(()=>{class m{constructor(l,s){this.sharedService=l,this.cdref=s}get isLoading(){return this.sharedService.isLoading}ngAfterContentChecked(){this.cdref.detectChanges()}ngOnInit(){}static#t=this.\u0275fac=function(s){return new(s||m)(a.rXU(p.d),a.rXU(a.gRc))};static#e=this.\u0275cmp=a.VBU({type:m,selectors:[["app-attendance"]],decls:2,vars:1,consts:[["mode","indeterminate","class","mb-3",4,"ngIf"],["mode","indeterminate",1,"mb-3"]],template:function(s,h){1&s&&(a.DNE(0,j,1,0,"mat-progress-bar",0),a.nrm(1,"router-outlet")),2&s&&a.Y8G("ngIf",h.isLoading)},dependencies:[u.bT,t.n3,A.HM]})}return m})();var O=r(2214),R=r(4714),E=r(2221),b=r(4460);let _=(()=>{class m{constructor(){}getCurrentLocation(){return new Promise((l,s)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(h=>{h&&l({lat:h.coords.latitude,lng:h.coords.longitude})},h=>console.log(h)):s("Geolocation is not supported by this browser.")})}static#t=this.\u0275fac=function(s){return new(s||m)};static#e=this.\u0275prov=a.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})();const f=["openmodal"],k=["videoElement"],F=[{path:"",component:$,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:O.n,data:{title:"Attendance Board"}},{path:"punch",component:(()=>{class m{constructor(l,s,h,y){this.service=l,this.sharedService=s,this.attendanceService=h,this.locationService=y,this.location={lat:26.85358663613167,lng:75.7707510358477},this.isPunchIn=!1,this.isPunchOut=!0}ngOnInit(){this.getLocation(),this.checkAttendanceStatus(),this.sharedService.changeTitle("Punch In And Out")}getLocation(){this.locationService.getCurrentLocation().then(l=>{this.location=l}).catch(l=>{this.locationError=l.message})}punchIn(){if(this.getLocation(),this.sharedService.isLoading=!0,this.location){const l=new FormData;l.append("punchIn","true"),l.append("lat",this.location.lat),l.append("long",this.location.lng),this.attId&&l.append("attId",this.attId),this.attendanceService.markAttendance(l).subscribe(s=>{(s.success||"Attendance recorded successfully"===s.message)&&(this.sharedService.displayServerMessage("Punch In Succesfully","success"),this.checkAttendanceStatus())},s=>{s&&s.error&&this.sharedService.displayServerMessage(s.error.message,"error"),this.sharedService.isLoading=!1},()=>{this.sharedService.isLoading=!1})}else this.sharedService.displayServerMessage(this.locationError,"error")}punchOut(){if(this.getLocation(),this.sharedService.isLoading=!0,this.location){const l=new FormData;l.append("punchOut","true"),l.append("lat",this.location.lat),l.append("long",this.location.lng),this.attId&&l.append("attId",this.attId),this.attendanceService.markAttendance(l).subscribe(s=>{(s.success||"Attendance recorded successfully"===s.message)&&(this.sharedService.displayServerMessage("Punch Out Succesfully","success"),this.checkAttendanceStatus())},s=>{s&&s.error&&this.sharedService.displayServerMessage(s.error.message,"error"),this.sharedService.isLoading=!1},()=>{this.sharedService.isLoading=!1})}else this.sharedService.displayServerMessage(this.locationError,"error")}checkAttendanceStatus(){const l=localStorage.getItem("userId")||"";this.attendanceService.checkAttendanceStatus(l).subscribe(s=>{s.success&&(s.data.checkTodayAtt.punchIn&&s.data.checkTodayAtt.punchOut?this.isPunchIn=!1:s.data.checkTodayAtt.punchIn&&(this.isPunchIn=!0),this.isPunchOut=s.data.checkTodayAtt.punchOut,this.punchInTime=this.convertTimeFormat(s.data.checkTodayAtt.punchInTime.toString()),this.punchOutTime=this.convertTimeFormat(s.data.checkTodayAtt.punchOutTime.toString()),s.data.checkTodayAtt.attDate&&(this.attDate=s.data.checkTodayAtt.attDate,this.attId=s.data.checkTodayAtt._id))},s=>{"Unauthorized access."===s.error.message&&this.sharedService.logOut()})}convertTimeFormat(l){if("0"===l)return"";const s=l.padStart(6,"0"),h=s.slice(0,2),y=s.slice(2,4),B=s.slice(4,6),P=parseInt(h,10),U=P<12||P>23?"AM":"PM";return`${(P%12||12).toString().padStart(2,"0")}:${y}:${B} ${U}`}static#t=this.\u0275fac=function(s){return new(s||m)(a.rXU(E.a),a.rXU(p.d),a.rXU(b.$),a.rXU(_))};static#e=this.\u0275cmp=a.VBU({type:m,selectors:[["app-attendance-punch-in-out"]],viewQuery:function(s,h){if(1&s&&(a.GBs(f,5),a.GBs(k,5),a.GBs(R.f,5)),2&s){let y;a.mGM(y=a.lsd())&&(h.openModalTemplateRef=y.first),a.mGM(y=a.lsd())&&(h.videoElement=y.first),a.mGM(y=a.lsd())&&(h.headers=y)}},features:[a.Jv_([E.a,u.QX])],decls:16,vars:6,consts:[[1,"card"],[1,"card-body","card-height"],[1,"justify-content-center","mb-2",2,"min-height","10rem"],[1,"row",2,"display","flex","align-items","center"],[1,"d-flex","flex-column","align-items-center","mb-5"],[1,"text-center",3,"ngbTooltip"],["type","button",1,"btn","btn-primary","mb-2",3,"click","disabled"],[1,"d-flex","flex-column","align-items-center","ml-md-3"]],template:function(s,h){1&s&&(a.j41(0,"div",0)(1,"div",1),a.nrm(2,"div",2),a.j41(3,"div",3)(4,"div",4)(5,"div",5)(6,"button",6),a.bIt("click",function(){return h.punchIn()}),a.EFF(7,"Punch In"),a.k0s(),a.j41(8,"p"),a.EFF(9),a.k0s()()(),a.j41(10,"div",7)(11,"div",5)(12,"button",6),a.bIt("click",function(){return h.punchOut()}),a.EFF(13,"Punch Out"),a.k0s(),a.j41(14,"p"),a.EFF(15),a.k0s()()()()()()),2&s&&(a.R7$(5),a.Y8G("ngbTooltip",h.isPunchIn?"First PunchOut To PunchIn Again.":""),a.R7$(),a.Y8G("disabled",h.isPunchIn),a.R7$(3),a.SpI("First Punch in Time: ",h.punchInTime,""),a.R7$(2),a.Y8G("ngbTooltip",h.isPunchOut?"First PunchIn To PunchOut.":""),a.R7$(),a.Y8G("disabled",h.isPunchOut),a.R7$(3),a.SpI("Last Punch Out Time: ",h.punchOutTime,""))},dependencies:[T.md],styles:[".card-height[_ngcontent-%COMP%]{min-height:30rem}"]})}return m})(),data:{title:"Mark Attendance"}}]}];let G=(()=>{class m{static#t=this.\u0275fac=function(s){return new(s||m)};static#e=this.\u0275mod=a.$C({type:m});static#n=this.\u0275inj=a.G2t({imports:[t.iI.forChild(F),t.iI]})}return m})(),w=(()=>{class m{static#t=this.\u0275fac=function(s){return new(s||m)};static#e=this.\u0275mod=a.$C({type:m});static#n=this.\u0275inj=a.G2t({imports:[u.MD,G,v.G,T.c9,T.h_,I.YN,I.X1,T.UN,M.fS,C.MQ]})}return m})()},4460:(Y,S,r)=>{r.d(S,{$:()=>C});var u=r(5312),I=r(4438),M=r(2616),T=r(1626);let C=(()=>{class v{constructor(a,p){this.sharedService=a,this.http=p,this.teamsUrl=u.c.adminUrl+"/Employees"}getAttendance(a,p){return this.sharedService.getRequest(this.teamsUrl+"/attendanceList"+(p??""),a)}getDownloadData(a,p){return this.http.get(this.teamsUrl+"/attendanceList"+(p??""),{params:a,responseType:"blob"})}getEmpoyeeList(){return this.sharedService.getRequest(u.c.adminUrl+"/Projects/employeeList")}markAttendance(a){return this.sharedService.postRequest(this.teamsUrl+"/attendance",a)}checkAttendanceStatus(a){return this.sharedService.getRequest(this.teamsUrl+"/checkDayAttendance/"+a)}checkEmployeeAttendanceStatus(a){return this.sharedService.getRequest(this.teamsUrl+"/getEmployeeAttendance/",a)}markEmployeeAttendance(a){return this.sharedService.postRequest(this.teamsUrl+"/updateEmployeeAttendance",a)}static#t=this.\u0275fac=function(p){return new(p||v)(I.KVO(M.d),I.KVO(T.Qq))};static#e=this.\u0275prov=I.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},4714:(Y,S,r)=>{r.d(S,{f:()=>M});var u=r(4438);const I={asc:"desc",desc:"","":"asc"};let M=(()=>{class T{constructor(){this.sortable="",this.direction="",this.sort=new u.bkB}rotate(){this.direction=I[this.direction],this.sort.emit({column:this.sortable,direction:this.direction})}static#t=this.\u0275fac=function(t){return new(t||T)};static#e=this.\u0275dir=u.FsC({type:T,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(t,a){1&t&&u.bIt("click",function(){return a.rotate()}),2&t&&u.AVh("asc","asc"===a.direction)("desc","desc"===a.direction)},inputs:{sortable:"sortable",direction:"direction"},outputs:{sort:"sort"}})}return T})()},2221:(Y,S,r)=>{r.d(S,{a:()=>E});var u=r(4412),I=r(1413),M=r(7673);const T=[];var C=r(8141),v=r(152),t=r(5558),a=r(1986),p=r(5312),A=r(4438),j=r(177);let E=(()=>{class b{constructor(f){this.pipe=f,this._loading$=new u.t(!0),this._search$=new I.B,this._data$=new u.t([]),this._total$=new u.t(0),this._state={page:p.k.page,pageSize:p.k.pageSize,searchTerm:"",sortColumn:"",sortDirection:""},this._search$.pipe((0,C.M)(()=>this._loading$.next(!0)),(0,v.B)(200),(0,t.n)(()=>this._search()),(0,a.c)(200),(0,C.M)(()=>this._loading$.next(!1))).subscribe(k=>{this._data$.next(k.Details),this._total$.next(k.total)}),this._search$.next()}get supportdata$(){return this._data$.asObservable()}get total$(){return this._total$.asObservable()}get loading$(){return this._loading$.asObservable()}get page(){return this._state.page}get pageSize(){return this._state.pageSize}get searchTerm(){return this._state.searchTerm}set page(f){this._set({page:f})}set pageSize(f){this._set({pageSize:f})}set searchTerm(f){this._set({searchTerm:f})}set sortColumn(f){this._set({sortColumn:f})}set sortDirection(f){this._set({sortDirection:f})}_set(f){Object.assign(this._state,f),this._search$.next()}_search(){const{sortColumn:f,sortDirection:k,pageSize:x,page:F,searchTerm:G}=this._state;let w=function O(b,_,f){return""===f||""===_?b:[...b].sort((k,x)=>{const F=((b,_)=>b<_?-1:b>_?1:0)(k[_],x[_]);return"asc"===f?F:-F})}(T,f,k);w=w.filter(X=>function R(b,_,f){return b.name.toLowerCase().includes(_.toLowerCase())||b.position.toLowerCase().includes(_.toLowerCase())||f.transform(b.salary).includes(_)||b.office.toLowerCase().includes(_.toLowerCase())||f.transform(b.extn).includes(_)||b.email.toLowerCase().includes(_.toLowerCase())}(X,G,this.pipe));const m=w.length;return w=w.slice((F-1)*x,(F-1)*x+x),(0,M.of)({Details:w,total:m})}static#t=this.\u0275fac=function(k){return new(k||b)(A.KVO(j.QX))};static#e=this.\u0275prov=A.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);